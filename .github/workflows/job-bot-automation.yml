name: 24/7 Automated Job Bot

on:
  schedule:
    # Run every 2 hours (1 hour work, 1 hour rest)
    - cron: '0 */2 * * *'
  workflow_dispatch: # Allow manual trigger
  push:
    branches: [ main ]

jobs:
  job-application-bot:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install Firefox browser and WebDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y firefox xvfb
        # Install Firefox WebDriver (geckodriver)
        GECKO_VERSION=$(curl -s "https://api.github.com/repos/mozilla/geckodriver/releases/latest" | grep '"tag_name":' | sed -E 's/.*"v([^"]+)".*/\1/')
        curl -sL "https://github.com/mozilla/geckodriver/releases/latest/download/geckodriver-v${GECKO_VERSION}-linux64.tar.gz" | sudo tar -xz -C /usr/local/bin/
        sudo chmod +x /usr/local/bin/geckodriver

    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Set up environment variables
      run: |
        cat > .env << EOF
        FULL_NAME=${{ secrets.FULL_NAME }}
        EMAIL=${{ secrets.EMAIL }}
        PHONE=${{ secrets.PHONE }}
        LINKEDIN=${{ secrets.LINKEDIN }}
        GITHUB_URL=${{ secrets.GITHUB_URL }}
        LOCATION=${{ secrets.LOCATION }}

        # Platform Credentials
        TWITTER_EMAIL=${{ secrets.TWITTER_EMAIL }}
        TWITTER_PASSWORD=${{ secrets.TWITTER_PASSWORD }}
        INDEED_EMAIL=${{ secrets.INDEED_EMAIL }}
        INDEED_PASSWORD=${{ secrets.INDEED_PASSWORD }}
        DICE_EMAIL=${{ secrets.DICE_EMAIL }}
        DICE_PASSWORD=${{ secrets.DICE_PASSWORD }}
        WEWORKREMOTELY_EMAIL=${{ secrets.WEWORKREMOTELY_EMAIL }}
        WEWORKREMOTELY_PASSWORD=${{ secrets.WEWORKREMOTELY_PASSWORD }}
        TURING_EMAIL=${{ secrets.TURING_EMAIL }}
        TURING_PASSWORD=${{ secrets.TURING_PASSWORD }}
        REMOTEOK_EMAIL=${{ secrets.REMOTEOK_EMAIL }}
        REMOTEOK_PASSWORD=${{ secrets.REMOTEOK_PASSWORD }}
        FLEXJOBS_EMAIL=${{ secrets.FLEXJOBS_EMAIL }}
        FLEXJOBS_PASSWORD=${{ secrets.FLEXJOBS_PASSWORD }}

        # Job Preferences
        JOB_TITLES=DevOps Engineer,Cloud Engineer,Site Reliability Engineer (SRE),Infrastructure Engineer,Platform Engineer,AWS Engineer,Kubernetes Administrator,CI/CD Engineer,Linux Systems Engineer,Cloud Automation Engineer,Junior DevOps Associate,Remote DevOps Intern
        SKILLS=DevOps,AWS,Docker,Kubernetes,Python,Linux,CI/CD,Jenkins,Terraform
        SALARY_MIN=50000
        REMOTE_ONLY=false
        EXPERIENCE_LEVEL=Entry and Mid
        EOF

    - name: Create application proofs directory
      run: mkdir -p application_proofs

    - name: Run job bot
      run: |
        export DISPLAY=:99
        Xvfb :99 -screen 0 1920x1080x24 > /dev/null 2>&1 &
        python super_ultimate_bot.py
      env:
        PYTHONPATH: .

    - name: Upload application proofs & logs
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: application-proofs-${{ github.run_number }}
        path: |
          application_proofs/
          super_ultimate_applications.txt
          super_ultimate_cycle_log.txt
        retention-days: 30

    - name: Send log notification
      if: always()
      run: |
        echo "âœ… Job bot cycle completed at $(date)"
        echo "ðŸ“„ Artifacts uploaded: application_proofs, logs, screenshots"
        echo "ðŸ•’ Next run scheduled in ~2 hours."
